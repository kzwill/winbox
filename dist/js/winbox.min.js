/**
 * WinBox.js v1.1.0
 * Copyright 2022 Nextapps GmbH
 * Update: Kangzw
 * Licence: Apache-2.0
 * https://github.com/nextapps-de/winbox
 */
(function(){'use strict';var f;function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function g(a){if(!(a instanceof Array)){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];a=b?b.call(a):{next:aa(a)};for(var c=[];!(b=a.next()).done;)c.push(b.value);a=c}return a}var ba=document.createElement("div");ba.innerHTML="<div class=wb-header><div class=wb-control><span class=wb-min></span><span class=wb-max></span><span class=wb-full></span><span class=wb-close></span></div><div class=wb-drag><div class=wb-icon></div><div class=wb-title></div></div></div><div class=wb-body></div><div class=wb-n></div><div class=wb-s></div><div class=wb-w></div><div class=wb-e></div><div class=wb-nw></div><div class=wb-ne></div><div class=wb-se></div><div class=wb-sw></div>";function l(a,b,c,e){a&&a.addEventListener(b,c,e||!1)}function m(a,b,c){var e=window;e&&e.removeEventListener(a,b,c||!1)}function r(a){a.stopPropagation();a.cancelable&&a.preventDefault()}function u(a,b,c){c=""+c;a["_s_"+b]!==c&&(a.style.setProperty(b,c),a["_s_"+b]=c)};var x=[],y={capture:!0,passive:!0},z,ea=0,A=10,B,J,K,fa,O,P;
function Q(a,b){if(!(this instanceof Q))return new Q(a);z||ha();var c;if(a){if(b){var e=a;a=b}if("string"===typeof a)e=a;else{var d=a.id;var h=a.index;var n=a.root;var F=a.template;e=e||a.title;var v=a.icon;var R=a.mount;var k=a.html;var C=a.url;var q=a.width;var t=a.height;var ca=a.scale||1;var D=a.minwidth;var E=a.minheight;var w=a.maxwidth;var p=a.maxheight;var G=a.autosize;var H=a.min;var I=a.max;var na=a.hidden;var da=a.modal;var oa=a.alwaysShow;var X=a.x||(da?"center":0);var Y=a.y||(da?"center":
0);var L=a.top;var M=a.left;var S=a.bottom;var T=a.right;var ia=a.background;var N=a.border;var U=a.header;var Z=a["class"];var pa=a["class"];var qa=a.remark;var ra=a.onclose;var sa=a.onfocus;var ta=a.onblur;var ua=a.onmove;var va=a.onresize;var wa=a.onfullscreen;var xa=a.onmaximize;var ya=a.onminimize;var za=a.onrestore;var Aa=a.onhide;var Ba=a.onshow;var Ca=a.onload}}if(d&&[].concat(g(Q.list),g(Q._list)).filter(function(Da){return Da.id===d}).length)console.warn(d+" \u91cd\u590d\uff0c\u521b\u5efa\u5931\u8d25!");
else{this.g=(F||ba).cloneNode(!0);this.g.id=this.id=d||"winbox-"+ ++ea;this.g.className="winbox"+(Z?" "+("string"===typeof Z?Z:Z.join(" ")):"")+(da?" modal":"");this.g.winbox=this;this.window=this.g;this.body=this.g.getElementsByClassName("wb-body")[0];this.h=U||35;ia&&this.setBackground(ia);N?u(this.body,"margin",N+(isNaN(N)?"":"px")):N=0;U&&(b=this.g.getElementsByClassName("wb-header")[0],u(b,"height",U+"px"),u(b,"line-height",U+"px"),u(this.body,"top",U+"px"));e&&this.setTitle(e);v&&this.setIcon(v);
R?this.mount(R):k?this.body.innerHTML=k:C&&this.setUrl(C,Ca);L=L?V(L,P):0;S=S?V(S,P):0;M=M?V(M,O):0;T=T?V(T,O):0;e=O-M-T;v=P-L-S;w=w?V(w,e):e;p=p?V(p,v):v;D=D?V(D,w):150;E=E?V(E,p):this.h;G?((n||z).appendChild(this.body),q=Math.max(Math.min(this.body.clientWidth+2*N+1,w),D),t=Math.max(Math.min(this.body.clientHeight+this.h+N+1,p),E),this.g.appendChild(this.body)):(q=q?V(q,w):Math.max(w/2,D)|0,t=t?V(t,p):Math.max(p/2,E)|0);X=X?V(X,e,q):M;Y=Y?V(Y,v,t):L;this.x=X;this.y=Y;this.width=q;this.height=t;
this.o=D;this.m=E;this.l=w;this.j=p;this.scale=ca;this.alwaysShow=oa;this.remark=qa;this.top=L;this.right=T;this.bottom=S;this.left=M;this.index=h;this.clazz=pa;this.focused=this.hidden=this.full=this.max=this.min=!1;this.onclose=ra;this.onfocus=sa;this.onblur=ta;this.onmove=ua;this.onresize=va;this.onfullscreen=wa;this.onmaximize=xa;this.onminimize=ya;this.onrestore=za;this.onhide=Aa;this.onshow=Ba;I?this.maximize():H?this.minimize():this.resize().move();if(na)this.hide();else if(this.focus(),h||
0===h)this.index=h,u(this.g,"z-index",h),h>A&&(A=h);ja(this);(n||z).appendChild(this.g);this.alwaysShow?Q._list.push(this):Q.list.push(this);(c=a.oncreate)&&c.call(this,a)}}Q["new"]=function(a){return new Q(a)};Q.list=[];Q._list=[];
Q.query=function(a){a=void 0===a?null:a;var b=Q.list.concat(Q._list);if(a){if("string"===typeof a)return a.startsWith("#")?b.filter(function(d){return d.id===a.substring(1)}):b.filter(function(d){return d.name===a});if("object"===typeof a){if(ka(a)){var c=Object.keys(a),e=b;c.forEach(function(d){e=e.filter(function(h){return h[d]===a[d]})});return e}if(/^\/.{1,}\/$/.test(a))return b.filter(function(d){return a.test(d.name)})}else return[]}else return[]};
Q.close=function(a){if(a=void 0===a?null:a)Q.query(a).forEach(function(b){b.close&&b.close()});else for(a=Q.list.length;0<a;a--)Q.list[a-1].close()};Q.closeAll=function(a){if(void 0===a?0:a){a=[].concat(g(Q.list),g(Q._list));for(var b=a.length,c=0;c<b;c++)a[c]&&a[c].close()}else for(a=[].concat(g(Q.list)),b=a.length,c=0;c<b;c++)a[c].close()};function ka(a){return"object"==typeof a&&"[object object]"==Object.prototype.toString.call(a).toLowerCase()&&!a.length}
function V(a,b,c){"string"===typeof a&&("center"===a?a=(b-c)/2|0:"right"===a||"bottom"===a?a=b-c:(c=parseFloat(a),a="%"===(""+c!==a&&a.substring((""+c).length))?b/100*c|0:c));return a}function ha(){z=document.body;z[K="requestFullscreen"]||z[K="msRequestFullscreen"]||z[K="webkitRequestFullscreen"]||z[K="mozRequestFullscreen"]||(K="");fa=K&&K.replace("request","exit").replace("mozRequest","mozCancel").replace("Request","Exit");l(window,"resize",function(){la();ma()});la()}
function ja(a){W(a,"drag");W(a,"n");W(a,"s");W(a,"w");W(a,"e");W(a,"nw");W(a,"ne");W(a,"se");W(a,"sw");l(a.g.getElementsByClassName("wb-min")[0],"click",function(b){r(b);a.min?a.focus().restore():a.blur().minimize()});l(a.g.getElementsByClassName("wb-max")[0],"click",function(){a.max?a.restore():a.maximize()});K?l(a.g.getElementsByClassName("wb-full")[0],"click",function(){a.fullscreen()}):a.addClass("no-full");l(a.g.getElementsByClassName("wb-close")[0],"click",function(b){r(b);a.close()||(a=null)});
l(a.g,"click",function(){a.focus()})}function Ea(a){x.splice(x.indexOf(a),1);ma();a.removeClass("min");a.min=!1;a.g.title=""}function ma(){for(var a=x.length,b={},c={},e=0,d;e<a;e++)d=x[e],d=(d.left||d.right)+":"+(d.top||d.bottom),c[d]?c[d]++:(b[d]=0,c[d]=1);e=0;for(var h,n;e<a;e++)d=x[e],h=(d.left||d.right)+":"+(d.top||d.bottom),n=Math.min((O-d.left-d.right)/c[h],250),d.resize(n+1|0,d.h,!0).move(d.left+b[h]*n|0,P-d.bottom-d.h,!0),b[h]++}
function W(a,b){function c(k){r(k);a.focus();if("drag"===b){if(a.min){a.restore();return}var C=Date.now(),q=C-R;R=C;if(300>q){a.max?a.restore():a.maximize();return}}a.max||a.min||(z.classList.add("wb-lock"),(n=k.touches)&&(n=n[0])?(k=n,l(window,"touchmove",e,y),l(window,"touchend",d,y)):(l(window,"mousemove",e),l(window,"mouseup",d)),F=k.pageX,v=k.pageY)}function e(k){r(k);n&&(k=k.touches[0]);var C=k.pageX;k=k.pageY;var q=C-F,t=k-v,ca=a.width,D=a.height,E=a.x,w=a.y,p;if("drag"===b){a.x+=q;a.y+=t;
var G=p=1}else{if("e"===b||"se"===b||"ne"===b){a.width+=q;var H=1}else if("w"===b||"sw"===b||"nw"===b)a.x+=q,a.width-=q,G=H=1;if("s"===b||"se"===b||"sw"===b){a.height+=t;var I=1}else if("n"===b||"ne"===b||"nw"===b)a.y+=t,a.height-=t,p=I=1}H&&(a.width=Math.max(Math.min(a.width,a.l,O-a.x-a.right),a.o),H=a.width!==ca);I&&(a.height=Math.max(Math.min(a.height,a.j,P-a.y-a.bottom),a.m),I=a.height!==D);(H||I)&&a.resize();G&&(a.x=Math.max(Math.min(a.x,O-a.width-a.right),a.left),G=a.x!==E);p&&(a.y=Math.max(Math.min(a.y,
P-a.height-a.bottom),a.top),p=a.y!==w);(G||p)&&a.move();if(H||G)F=C;if(I||p)v=k}function d(k){r(k);z.classList.remove("wb-lock");n?(m("touchmove",e,y),m("touchend",d,y)):(m("mousemove",e),m("mouseup",d))}var h=a.g.getElementsByClassName("wb-"+b)[0];if(h){var n,F,v,R=0;l(h,"mousedown",c);l(h,"touchstart",c,y)}}function la(){var a=document.documentElement;O=a.clientWidth;P=a.clientHeight}f=Q.prototype;
f.mount=function(a){this.unmount();a.i||(a.i=a.parentNode);this.body.textContent="";this.body.appendChild(a);return this};f.unmount=function(a){var b=this.body.firstChild;if(b){var c=a||b.i;c&&c.appendChild(b);b.i=a}return this};f.setTitle=function(a){var b=this.g.getElementsByClassName("wb-title")[0];a=this.title=a;var c=b.firstChild;c?c.nodeValue=a:b.textContent=a;return this};
f.setIcon=function(a){var b=this.g.getElementsByClassName("wb-icon")[0];u(b,"background-image","url("+a+")");u(b,"display","inline-block");return this};f.setBackground=function(a){u(this.g,"background",a);return this};f.setUrl=function(a,b){var c=this.body.firstChild;c&&"iframe"===c.tagName.toLowerCase()?c.src=a:(this.body.innerHTML='<iframe src="'+a+'"></iframe>',b&&(this.body.firstChild.onload=b));return this};
f.focus=function(a){if(!1===a)return this.blur();J!==this&&this.g&&(J&&J.blur(),u(this.g,"z-index",++A),this.index=A,this.addClass("focus"),J=this,this.focused=!0,this.onfocus&&this.onfocus());return this};f.blur=function(a){if(!1===a)return this.focus();J===this&&(this.removeClass("focus"),this.focused=!1,this.onblur&&this.onblur(),J=null);return this};f.hide=function(a){if(!1===a)return this.show();if(!this.hidden)return this.onhide&&this.onhide(),this.hidden=!0,this.addClass("hide")};
f.show=function(a){if(!1===a)return this.hide();if(this.hidden)return this.onshow&&this.onshow(),this.hidden=!1,this.removeClass("hide")};f.minimize=function(a){if(!1===a)return this.restore();B&&Fa();this.max&&(this.removeClass("max"),this.max=!1);this.min||(x.push(this),ma(),this.g.title=this.title,this.addClass("min"),this.min=!0,this.onminimize&&this.onminimize());return this};
f.restore=function(){B&&Fa();this.min&&(Ea(this),this.resize().move(),this.onrestore&&this.onrestore());this.max&&(this.max=!1,this.removeClass("max").resize().move(),this.onrestore&&this.onrestore());return this};f.maximize=function(a){if(!1===a)return this.restore();B&&Fa();this.min&&Ea(this);this.max||(this.addClass("max").resize(O-this.left-this.right,P-this.top-this.bottom,!0).move(this.left,this.top,!0),this.max=!0,this.onmaximize&&this.onmaximize());return this};
f.fullscreen=function(a){this.min&&(Ea(this),this.resize().move());if(!B||!Fa())this.body[K](),B=this,this.full=!0,this.onfullscreen&&this.onfullscreen();else if(!1===a)return this.restore();return this};function Fa(){B.full=!1;if(document.fullscreen||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)return document[fa](),!0}
f.close=function(a){var b=this;if(this.onclose&&this.onclose(a))return!0;this.min&&Ea(this);this.unmount();this.g.remove();this.g.textContent="";this.g=this.body=this.g.winbox=null;J===this&&(J=null);this.alwaysShow?Q._list.splice(Q._list.indexOf(Q._list.find(function(c){return c.id===b.id})),1):Q.list.splice(Q.list.indexOf(Q.list.find(function(c){return c.id===b.id})),1)};
f.move=function(a,b,c){a||0===a?c||(this.x=a?a=V(a,O-this.left-this.right,this.width):0,this.y=b?b=V(b,P-this.top-this.bottom,this.height):0):(a=this.x,b=this.y);u(this.g,"left",a+"px");u(this.g,"top",b+"px");u(this.g,"scale",this.scale);this.onmove&&this.onmove(a,b);return this};
f.resize=function(a,b,c){a||0===a?c||(this.width=a?a=V(a,this.l):0,this.height=b?b=V(b,this.j):0,a=Math.max(a,this.o),b=Math.max(b,this.m)):(a=this.width,b=this.height);u(this.g,"width",a+"px");u(this.g,"height",b+"px");u(this.g,"scale",this.scale);this.onresize&&this.onresize(a,b);return this};
f.addControl=function(a){var b=a["class"],c=a.image,e=a.click;a=a.index;var d=document.createElement("span"),h=this.g.getElementsByClassName("wb-control")[0],n=this;b&&(d.className=b);c&&u(d,"background-image","url("+c+")");e&&(d.onclick=function(F){e.call(this,F,n)});h.insertBefore(d,h.childNodes[a||0]);return this};f.removeControl=function(a){(a=this.g.getElementsByClassName(a)[0])&&a.remove();return this};f.addClass=function(a){this.g.classList.add(a);return this};
f.removeClass=function(a){this.g.classList.remove(a);return this};f.toggleClass=function(a){return this.g.classList.contains(a)?this.removeClass(a):this.addClass(a)};window.WinBox=Q;}).call(this);
